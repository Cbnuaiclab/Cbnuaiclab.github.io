<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>COOCON Agentic Terminal (CAT) Demo - Light Theme</title>
    <style>
        /* --- VS Code Light Theme (Modern) --- */
        :root {
            --vscode-bg: #ffffff;
            --vscode-sidebar-bg: #f3f3f3;
            --vscode-sidebar-border: #e7e7e7;
            --vscode-editor-bg: #ffffff;
            --vscode-terminal-bg: #ffffff;
            --vscode-text: #333333;
            --vscode-muted: #888888;
            --vscode-blue: #007acc;
            --vscode-green: #0097fb;
            --vscode-accent: #005fb8;
            --vscode-highlight: #e4e6f1;
            --border-color: #e7e7e7;
            --font-ui: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            --font-mono: 'Consolas', 'Courier New', monospace;
        }

        body, html {
            margin: 0; padding: 0; height: 100%;
            font-family: var(--font-ui);
            background-color: var(--vscode-bg);
            color: var(--vscode-text);
            overflow: hidden;
        }
        .main-container { display: flex; height: 100vh; }

        /* Activity Bar */
        .activity-bar {
            width: 48px;
            background-color: #2c2c2c;
            display: flex; flex-direction: column; align-items: center; padding-top: 10px;
            color: #9d9d9d;
        }
        .activity-icon { width: 24px; height: 24px; margin-bottom: 25px; cursor: pointer; display: flex; justify-content: center; align-items: center; }
        .activity-icon svg { fill: currentColor; width: 24px; height: 24px; }
        .activity-icon.active { color: #ffffff; border-left: 2px solid #ffffff; }

        /* Sidebar */
        .sidebar {
            width: 250px; background-color: var(--vscode-sidebar-bg);
            border-right: 1px solid var(--vscode-sidebar-border);
            display: flex; flex-direction: column; font-size: 13px;
        }
        .sidebar-header {
            padding: 10px 15px; font-weight: 600; text-transform: uppercase; font-size: 11px; color: var(--vscode-muted);
            display: flex; justify-content: space-between; align-items: center;
        }
        .file-tree { padding-left: 10px; }
        .file-item {
            padding: 4px 5px; cursor: pointer; display: flex; align-items: center;
            border-radius: 3px; color: var(--vscode-text);
        }
        .file-item:hover { background-color: #e8e8e8; }
        .file-item.selected { background-color: var(--vscode-highlight); color: var(--vscode-accent); }
        .file-icon { margin-right: 6px; width: 16px; text-align: center; }

        /* Editor Area */
        .editor-container {
            flex: 1;
            display: flex;
            flex-direction: column;
            background-color: var(--vscode-editor-bg);
            min-height: 0;
            overflow: hidden;
        }
        .editor-tabs {
            background-color: var(--vscode-sidebar-bg); display: flex; height: 35px;
            border-bottom: 1px solid var(--vscode-sidebar-border);
        }
        .tab {
            background-color: var(--vscode-editor-bg); padding: 0 10px 0 15px; display: flex; align-items: center;
            font-size: 13px; border-top: 2px solid var(--vscode-blue); border-right: 1px solid var(--vscode-sidebar-border);
            color: var(--vscode-text);
        }
        .tab-close { margin-left: 8px; cursor: pointer; color: var(--vscode-muted); }
        .editor-content {
            flex-grow: 1; padding: 10px 20px; font-family: var(--font-mono); font-size: 14px;
            white-space: pre; overflow: auto; line-height: 1.5;
        }

        /* Terminal Area */
        .panel-container {
            height: 45%; border-top: 1px solid var(--vscode-sidebar-border);
            background-color: var(--vscode-terminal-bg); display: flex; flex-direction: column;
            position: relative;
        }
        .panel-header {
            display: flex; padding: 8px 15px; background-color: var(--vscode-sidebar-bg);
            border-bottom: 1px solid var(--vscode-sidebar-border); font-size: 11px; color: var(--vscode-text);
            flex-shrink: 0;
        }
        .panel-tab { margin-right: 20px; cursor: pointer; color: var(--vscode-muted); text-transform: uppercase; }
        .panel-tab.active { color: var(--vscode-text); border-bottom: 1px solid var(--vscode-accent); font-weight: 600; }
        .terminal-content {
            flex: 1; padding: 10px 15px; font-family: var(--font-mono); font-size: 13px;
            overflow-y: auto; color: var(--vscode-text);
            overflow-x: hidden;
            min-height: 0;
            white-space: pre;
        }
        .terminal-line {
            margin-bottom: 2px;
            line-height: 1.2;
            white-space: pre;
            max-width: 100%;
        }
        .prompt-path { color: var(--vscode-blue); font-weight: bold; }
        .prompt-arrow { color: #b6b6b6; margin: 0 8px; font-weight: bold;}
        .command-input {
            background: transparent; border: none; color: var(--vscode-text);
            font-family: var(--font-mono); font-size: 13px; outline: none; width: 80%;
            cursor: default;
        }
        .command-input::placeholder {
            color: var(--vscode-muted);
            font-style: italic;
        }
        .ai-response {
            color: var(--vscode-accent);
            word-wrap: break-word;
            overflow-wrap: break-word;
        }
        .terminal-input-line {
            display: flex;
            align-items: center;
            flex-wrap: nowrap;
        }
        .tab-hint {
            color: var(--vscode-muted);
            font-size: 11px;
            margin-left: 10px;
            opacity: 0.7;
        }
        .typing-indicator::after { content: '‚ñà'; animation: blink 1s step-end infinite; opacity: 0.6; }
        @keyframes blink { 50% { opacity: 0; } }

        /* Status Bar */
        .status-bar {
            height: 22px; background-color: var(--vscode-blue); color: white;
            display: flex; justify-content: space-between; align-items: center;
            padding: 0 10px; font-size: 12px;
        }

        /* JS Syntax Highlighting (Light Theme) */
        .hl-comment { color: #008000; }
        .hl-keyword { color: #0000ff; }
        .hl-string { color: #a31515; }
        .hl-function { color: #795e26; }
        .hl-number { color: #098658; }
        .hl-type { color: #267f99; }
    </style>
</head>
<body>

<div class="main-container">
    <div class="activity-bar">
        <div class="activity-icon active" title="Explorer">
            <svg viewBox="0 0 24 24"><path d="M20 6h-8l-2-2H4c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V8c0-1.1-.9-2-2-2zm0 12H4V8h16v10z"/></svg>
        </div>
    </div>

    <div class="sidebar">
        <div class="sidebar-header">
            <span>Explorer</span>
            <span>...</span>
        </div>
        <div class="file-tree">
            <div class="file-item" style="font-weight: bold;"><span class="file-icon">v</span> MINWON_PROJECT</div>
            <div class="file-tree" style="padding-left: 15px;">
                <div class="file-item"><span class="file-icon" style="color:#dcb67a">‚òê</span> common_utils.js</div>
                <div class="file-item selected"><span class="file-icon" style="color:#cbcb41">JS</span> minwon_login.js</div>
                <div class="file-item"><span class="file-icon" style="color:#dcb67a">‚òê</span> package.json</div>
            </div>
        </div>
    </div>

    <div style="display: flex; flex-direction: column; flex: 1; min-width: 0; overflow: hidden;">

        <div class="editor-container">
            <div class="editor-tabs">
                <div class="tab">
                    <span class="file-icon" style="color:#cbcb41; margin-right: 5px;">JS</span>
                    minwon_login.js
                    <span class="tab-close">√ó</span>
                </div>
            </div>
            <div class="editor-content" id="codeEditor">
<span class="hl-comment">// File is empty.</span>
<span class="hl-comment">// Use the terminal below to generate the Minwon login module.</span>
<span class="hl-comment">// Press Tab in terminal to autocomplete, then Enter to run</span>
            </div>
        </div>

        <div class="panel-container">
            <div class="panel-header">
                <div class="panel-tab">PROBLEMS</div>
                <div class="panel-tab">OUTPUT</div>
                <div class="panel-tab">DEBUG CONSOLE</div>
                <div class="panel-tab active">TERMINAL</div>
                <div style="flex-grow:1"></div>
                <div>+ v ^ x</div>
            </div>
            <div class="terminal-content" id="terminalOutput"><div class="terminal-line" style="color: var(--vscode-muted);">Microsoft Windows [Version 10.0.19045.4651]</div><div class="terminal-line" style="color: var(--vscode-muted); margin-bottom: 10px;">(c) Microsoft Corporation. All rights reserved.</div><div id="terminalInteractionArea"><div class="terminal-input-line" style="display: flex;"><span class="prompt-path">C:\Projects\MINWON_PROJECT</span><span class="prompt-arrow">‚ùØ</span><input type="text" id="commandInput" class="command-input" autocomplete="off" spellcheck="false" autofocus><span class="tab-hint">‚á• Tab</span></div></div>
            </div>
        </div>

        <div class="status-bar">
            <div style="display:flex;"><div style="margin-right:15px">main*</div> <div>‚ìß 0 ‚ö† 0</div></div>
            <div style="display:flex;"><div style="margin-right:15px">Ln 1, Col 1</div> <div>UTF-8</div> <div style="margin-left:15px">JavaScript</div></div>
        </div>
    </div>
</div>

<script>
    // --- Demo State & Data ---
    const terminalOutput = document.getElementById('terminalOutput');
    const interactionArea = document.getElementById('terminalInteractionArea');
    const commandInput = document.getElementById('commandInput');
    const codeEditor = document.getElementById('codeEditor');

    // Step commands
    const stepCommands = [
        { cmd: 'coocon-agent init minwon_login', desc: 'Initialize COOCON Agent for MinWon module' },
        { cmd: 'coocon-agent implement-hardcoded', desc: 'Implement hardcoded authentication flow' },
        { cmd: 'coocon-agent detect-dynamic-query', desc: 'Detect dynamic query parameters' },
        { cmd: 'coocon-agent implement-empty-function', desc: 'Replace hardcoded values with functions' },
        { cmd: 'coocon-agent add-dynamic-function', desc: 'Add dynamicSignedVals function' },
        { cmd: 'coocon-agent add-function-details', desc: 'Add implementation comments' },
        { cmd: 'coocon-agent show-isas-library', desc: 'Show top iSAS library functions' }
    ];

    // Code states
    const initCode = `<span class="hl-comment">/* jshint -W107 */</span>
<span class="hl-keyword">var</span> moduleVersion = <span class="hl-string">"25.10.10.1"</span>;
<span class="hl-keyword">var</span> moduleName = <span class="hl-string">"MinWon_Î°úÍ∑∏Ïù∏"</span>;

<span class="hl-keyword">function</span> <span class="hl-function">iSASObject</span>() {
    <span class="hl-keyword">this</span>.iSASInOut = {};
    <span class="hl-keyword">this</span>.UID = <span class="hl-string">''</span>;
    <span class="hl-keyword">this</span>.AESKey = <span class="hl-string">''</span>;
}

<span class="hl-keyword">var</span> ÎØºÏõêÏã†Ï≤≠Ï°∞Ìöå = <span class="hl-keyword">function</span>() {
    <span class="hl-keyword">this</span>.host = <span class="hl-string">"https://plus.gov.kr"</span>;
    <span class="hl-keyword">this</span>.url = <span class="hl-string">""</span>;
    <span class="hl-keyword">this</span>.bLogIn = <span class="hl-keyword">false</span>;
};

ÎØºÏõêÏã†Ï≤≠Ï°∞Ìöå.prototype = Object.<span class="hl-function">create</span>(iSASObject.prototype);`;

    const hardcodedCode = initCode + `

iSASObject.prototype.<span class="hl-function">log</span> = <span class="hl-keyword">function</span>(logMsg) {
    <span class="hl-keyword">try</span> {
        <span class="hl-function">SASLog</span>(<span class="hl-string">"iSASObject.Log("</span> + logMsg + <span class="hl-string">"\")"</span>);
    } <span class="hl-keyword">catch</span> (e) {
        console.<span class="hl-function">log</span>(<span class="hl-string">"iSASObject.Log("</span> + logMsg + <span class="hl-string">"\")"</span>);
    }
};

iSASObject.prototype.<span class="hl-function">setError</span> = <span class="hl-keyword">function</span>(errcode) {
    <span class="hl-keyword">this</span>.iSASInOut.Output = {};
    <span class="hl-keyword">this</span>.iSASInOut.Output.ErrorCode = errcode.<span class="hl-function">toString</span>(<span class="hl-number">16</span>).<span class="hl-function">toUpperCase</span>();
    <span class="hl-keyword">this</span>.iSASInOut.Output.ErrorMessage = <span class="hl-function">getCooconErrMsg</span>(errcode.<span class="hl-function">toString</span>(<span class="hl-number">16</span>).<span class="hl-function">toUpperCase</span>());
};

ÎØºÏõêÏã†Ï≤≠Ï°∞Ìöå.prototype.Î°úÍ∑∏Ïù∏ = <span class="hl-keyword">function</span>(aInput) {
    <span class="hl-keyword">this</span>.<span class="hl-function">log</span>(moduleName + <span class="hl-string">" ÎØºÏõêÏã†Ï≤≠Ï°∞Ìöå Î°úÍ∑∏Ïù∏ Ìò∏Ï∂ú ["</span> + aInput + <span class="hl-string">"]["</span> + moduleVersion + <span class="hl-string">"]"</span>);
    <span class="hl-keyword">var</span> input = <span class="hl-function">dec</span>(aInput.Input);

    <span class="hl-keyword">try</span> {
        <span class="hl-comment">// Step 1: Page capture: Î°úÍ∑∏Ïù∏ | Ï†ïÎ∂Ä24</span>
        <span class="hl-keyword">this</span>.<span class="hl-function">log</span>(<span class="hl-string">"Step 1: Page capture: Î°úÍ∑∏Ïù∏ | Ï†ïÎ∂Ä24"</span>);
        <span class="hl-keyword">this</span>.url = <span class="hl-string">"/login"</span>;

        <span class="hl-keyword">if</span> (httpRequest.<span class="hl-function">getWithUserAgent</span>(<span class="hl-function">JSON.stringify</span>({}), <span class="hl-keyword">this</span>.host + <span class="hl-keyword">this</span>.url) == <span class="hl-keyword">false</span>) {
            <span class="hl-keyword">this</span>.<span class="hl-function">setError</span>(E_IBX_FAILTOGETPAGE);
            <span class="hl-keyword">return</span> E_IBX_FAILTOGETPAGE;
        }

        <span class="hl-comment">// Step 2: API: certCertificate</span>
        <span class="hl-keyword">this</span>.<span class="hl-function">log</span>(<span class="hl-string">"Step 2: API: certcertficate"</span>);
        <span class="hl-keyword">this</span>.url = <span class="hl-string">"/api/user/v1.0/cert/certCertificate"</span>;

        <span class="hl-keyword">var</span> requestBody = {
            <span class="hl-string">"unityLgnUseYn"</span>: <span class="hl-string">"N"</span>,
            <span class="hl-string">"lgnTypeCd"</span>: <span class="hl-string">"03"</span>,
            <span class="hl-string">"signedVals"</span>: <span class="hl-string">"308207a206092a864886f70d010702a08207933082078f..."</span>,
            <span class="hl-string">"awqf"</span>: <span class="hl-string">"!2a"</span>
        };

        <span class="hl-keyword">if</span> (httpRequest.<span class="hl-function">postWithUserAgent</span>(<span class="hl-function">JSON.stringify</span>(headers), <span class="hl-keyword">this</span>.host + <span class="hl-keyword">this</span>.url, <span class="hl-function">JSON.stringify</span>(requestBody)) == <span class="hl-keyword">false</span>) {
            <span class="hl-keyword">this</span>.<span class="hl-function">setError</span>(E_IBX_FAILTOGETPAGE);
            <span class="hl-keyword">return</span> E_IBX_FAILTOGETPAGE;
        }

        <span class="hl-comment">// Step 3: Verify user session</span>
        <span class="hl-keyword">this</span>.<span class="hl-function">log</span>(<span class="hl-string">"Step 3: Verify user session after login"</span>);
        <span class="hl-keyword">this</span>.url = <span class="hl-string">"/api/member/v1.0/nlogin/checkUserSession"</span>;

        <span class="hl-keyword">if</span> (httpRequest.<span class="hl-function">postWithUserAgent</span>(<span class="hl-function">JSON.stringify</span>(headers), <span class="hl-keyword">this</span>.host + <span class="hl-keyword">this</span>.url, <span class="hl-keyword">this</span>.postData) == <span class="hl-keyword">false</span>) {
            <span class="hl-keyword">this</span>.<span class="hl-function">setError</span>(E_IBX_FAILTOGETPAGE);
            <span class="hl-keyword">return</span> E_IBX_FAILTOGETPAGE;
        }

        <span class="hl-comment">// Step 4: Post-login page</span>
        <span class="hl-keyword">this</span>.<span class="hl-function">log</span>(<span class="hl-string">"Step 4: Post-login page: Î©îÏù∏ | Ï†ïÎ∂Ä24"</span>);
        <span class="hl-keyword">this</span>.url = <span class="hl-string">"/"</span>;

        <span class="hl-keyword">if</span> (httpRequest.<span class="hl-function">getWithUserAgent</span>(<span class="hl-function">JSON.stringify</span>({}), <span class="hl-keyword">this</span>.host + <span class="hl-keyword">this</span>.url) == <span class="hl-keyword">false</span>) {
            <span class="hl-keyword">this</span>.<span class="hl-function">setError</span>(E_IBX_FAILTOGETPAGE);
            <span class="hl-keyword">return</span> E_IBX_FAILTOGETPAGE;
        }

        <span class="hl-keyword">this</span>.iSASInOut.Output = {};
        <span class="hl-keyword">this</span>.iSASInOut.Output.ErrorCode = <span class="hl-string">"00000000"</span>;
        <span class="hl-keyword">return</span> S_IBX_OK;
    } <span class="hl-keyword">catch</span> (e) {
        <span class="hl-keyword">this</span>.<span class="hl-function">log</span>(<span class="hl-string">"exception "</span> + e.message);
        <span class="hl-keyword">this</span>.<span class="hl-function">setError</span>(E_IBX_UNKNOWN);
        <span class="hl-keyword">return</span> E_IBX_UNKNOWN;
    } <span class="hl-keyword">finally</span> {
        system.<span class="hl-function">setStatus</span>(IBXSTATE_DONE, <span class="hl-number">100</span>);
    }
};`;

    const codeStates = {
        init: initCode,
        hardcoded: hardcodedCode,
        detectQuery: hardcodedCode.replace(
            '<span class="hl-string">"signedVals"</span>: <span class="hl-string">"308207a2',
            '<span class="hl-type">// DYNAMIC PARAMETER ‚Üì</span>\n            <span class="hl-string">"signedVals"</span>: <span class="hl-string">"308207a2'
        ),
        emptyFunction: hardcodedCode.replace(
            '<span class="hl-string">"308207a206092a864886f70d010702a08207933082078f..."</span>',
            '<span class="hl-keyword">this</span>.<span class="hl-function">dynamicSignedVals</span>(input.Ïù∏Ï¶ùÏÑú)'
        ),
        addFunction: hardcodedCode.replace(
            '<span class="hl-string">"308207a206092a864886f70d010702a08207933082078f..."</span>',
            '<span class="hl-keyword">this</span>.<span class="hl-function">dynamicSignedVals</span>(input.Ïù∏Ï¶ùÏÑú)'
        ) + `

<span class="hl-comment">// Added at bottom of file:</span>
ÎØºÏõêÏã†Ï≤≠Ï°∞Ìöå.prototype.<span class="hl-function">dynamicSignedVals</span> = <span class="hl-keyword">function</span>(cert) {
    <span class="hl-comment">// Empty function to generate signed values</span>
    <span class="hl-keyword">return</span> <span class="hl-string">""</span>;
};`,
        functionDetails: hardcodedCode.replace(
            '<span class="hl-string">"308207a206092a864886f70d010702a08207933082078f..."</span>',
            '<span class="hl-keyword">this</span>.<span class="hl-function">dynamicSignedVals</span>(input.Ïù∏Ï¶ùÏÑú)'
        ) + `

<span class="hl-comment">// Added at bottom of file:</span>
ÎØºÏõêÏã†Ï≤≠Ï°∞Ìöå.prototype.<span class="hl-function">dynamicSignedVals</span> = <span class="hl-keyword">function</span>(cert) {
    <span class="hl-comment">/**
     * Implementation steps:
     * 1. Extract certificate data
     * 2. Create PKCS#7 SignedData structure
     * 3. Encode to Base64/Hex format
     * 4. Return the signed value string
     */</span>
    <span class="hl-keyword">var</span> signedData = certManager.<span class="hl-function">createSignedData</span>(cert);
    <span class="hl-keyword">return</span> signedData.<span class="hl-function">toHexString</span>();
};`,
        isasLibrary: `<span class="hl-comment">/**
 * Top 3 iSAS Library Functions
 */</span>

<span class="hl-comment">// 1. certManager - Certificate management</span>
certManager.<span class="hl-function">findCert</span>(certJSON)
certManager.<span class="hl-function">signData</span>(cert, data)
certManager.<span class="hl-function">verifyPassword</span>(pwd)

<span class="hl-comment">// 2. httpRequest - HTTP communication</span>
httpRequest.<span class="hl-function">getWithUserAgent</span>(headers, url)
httpRequest.<span class="hl-function">postWithUserAgent</span>(headers, url, data)
httpRequest.result

<span class="hl-comment">// 3. system - System utilities</span>
system.<span class="hl-function">include</span>(moduleName)
system.<span class="hl-function">setStatus</span>(state, progress)
<span class="hl-function">dec</span>(encodedData)

<span class="hl-comment">// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê</span>
<span class="hl-comment">// COMPLETE IMPLEMENTATION WITH ALL VALIDATION</span>

` + hardcodedCode.replace(
            '<span class="hl-string">"308207a206092a864886f70d010702a08207933082078f..."</span>',
            '<span class="hl-keyword">this</span>.<span class="hl-function">dynamicSignedVals</span>(input.Ïù∏Ï¶ùÏÑú)'
        ).replace(
            '<span class="hl-keyword">var</span> input = <span class="hl-function">dec</span>(aInput.Input);',
            `<span class="hl-keyword">var</span> result = <span class="hl-string">""</span>;
    <span class="hl-keyword">var</span> errCode = <span class="hl-number">0</span>;
    <span class="hl-keyword">var</span> input = <span class="hl-function">dec</span>(aInput.Input);

    <span class="hl-comment">// Input validation</span>
    <span class="hl-keyword">if</span> (!input.Î°úÍ∑∏Ïù∏Î∞©Ïãù || input.Î°úÍ∑∏Ïù∏Î∞©Ïãù !== <span class="hl-string">"CERT"</span>) {
        <span class="hl-keyword">this</span>.<span class="hl-function">setError</span>(E_IBX_LOGIN_TYPE_ERROR);
        <span class="hl-keyword">return</span> E_IBX_LOGIN_TYPE_ERROR;
    }

    <span class="hl-keyword">if</span> (!input.Ïù∏Ï¶ùÏÑú || !input.Ïù∏Ï¶ùÏÑú.Ïù¥Î¶Ñ) {
        <span class="hl-keyword">this</span>.<span class="hl-function">setError</span>(E_IBX_KEY_ACCOUNT_INFO_1_NOTENTER);
        <span class="hl-keyword">return</span> E_IBX_KEY_ACCOUNT_INFO_1_NOTENTER;
    }

    <span class="hl-keyword">if</span> (!certManager.<span class="hl-function">findCert</span>(<span class="hl-function">JSON.stringify</span>(input.Ïù∏Ï¶ùÏÑú))) {
        <span class="hl-keyword">this</span>.<span class="hl-function">setError</span>(E_IBX_CERTIFY_NOT_FOUND);
        <span class="hl-keyword">return</span> E_IBX_CERTIFY_NOT_FOUND;
    }

    <span class="hl-keyword">if</span> (!certManager.<span class="hl-function">verifyPassword</span>(input.Ïù∏Ï¶ùÏÑú.ÎπÑÎ∞ÄÎ≤àÌò∏)) {
        <span class="hl-keyword">this</span>.<span class="hl-function">setError</span>(E_IBX_KEY_ACCOUNT_PASSWORD_1_INVALID);
        <span class="hl-keyword">return</span> E_IBX_KEY_ACCOUNT_PASSWORD_1_INVALID;
    }`
        ) + `

<span class="hl-comment">// Added dynamic function:</span>
ÎØºÏõêÏã†Ï≤≠Ï°∞Ìöå.prototype.<span class="hl-function">dynamicSignedVals</span> = <span class="hl-keyword">function</span>(cert) {
    <span class="hl-comment">// Create PKCS#7 SignedData from certificate</span>
    <span class="hl-keyword">var</span> signedData = certManager.<span class="hl-function">createSignedData</span>(cert);
    <span class="hl-keyword">return</span> signedData.<span class="hl-function">toHexString</span>();
};

<span class="hl-comment">// Module initialization functions</span>
<span class="hl-keyword">function</span> <span class="hl-function">OnInit</span>() {
    system.<span class="hl-function">include</span>(<span class="hl-string">"iSASTypes"</span>);
    system.<span class="hl-function">include</span>(<span class="hl-string">"sas/sas"</span>);
    system.<span class="hl-function">include</span>(<span class="hl-string">"common/common"</span>);
    system.<span class="hl-function">setStatus</span>(IBXSTATE_BEGIN, <span class="hl-number">0</span>);
}

<span class="hl-keyword">function</span> <span class="hl-function">Execute</span>(aInput) {
    <span class="hl-keyword">try</span> {
        <span class="hl-function">OnInit</span>();
        iSASObj = <span class="hl-function">JSON.parse</span>(aInput);
        <span class="hl-keyword">var</span> ClassName = iSASObj.Class;
        <span class="hl-keyword">var</span> ModuleName = iSASObj.Module;
        <span class="hl-keyword">return</span> <span class="hl-function">JSON.stringify</span>(iSASObj);
    } <span class="hl-keyword">catch</span> (e) {
        <span class="hl-keyword">return</span> <span class="hl-function">JSON.stringify</span>({ErrorCode: <span class="hl-string">"8000F110"</span>});
    }
}`
    };

    // Terminal Logic
    let commandHistory = [];
    let currentStep = 0;

    async function typeTerminalLine(text, isAI = false) {
        const line = document.createElement('div');
        line.className = 'terminal-line' + (isAI ? ' ai-response typing-indicator' : '');
        interactionArea.parentNode.insertBefore(line, interactionArea);

        for (let i = 0; i < text.length; i++) {
            line.textContent += text[i];
            if (i % 3 === 0) {
                await new Promise(r => setTimeout(r, 10));
                terminalOutput.scrollTop = terminalOutput.scrollHeight;
            }
        }
        line.classList.remove('typing-indicator');
        terminalOutput.scrollTop = terminalOutput.scrollHeight;
    }

    function updateEditor(htmlContent) {
        codeEditor.style.opacity = 0.5;
        setTimeout(() => {
            codeEditor.innerHTML = htmlContent;
            codeEditor.style.opacity = 1;
        }, 200);
    }

    function addCommandToHistory(cmd) {
        const prevCmdLine = document.createElement('div');
        prevCmdLine.className = 'terminal-line';
        prevCmdLine.style.display = 'flex';
        prevCmdLine.innerHTML = `<span class="prompt-path">C:\\Projects\\MINWON_PROJECT</span><span class="prompt-arrow">‚ùØ</span> <span>${cmd}</span>`;
        interactionArea.parentNode.insertBefore(prevCmdLine, interactionArea);
        commandHistory.push(cmd);
        terminalOutput.scrollTop = terminalOutput.scrollHeight;
    }

    // Command handlers
    async function handleCommand(cmd) {
        addCommandToHistory(cmd);
        commandInput.value = '';
        commandInput.disabled = true;

        if (cmd.trim() === 'coocon-agent init minwon_login' && currentStep === 0) {
            await typeTerminalLine('ü§ñ CAT Agent v1.2.0 initializing...', true);
            await typeTerminalLine('‚ñ∫ Target: MinWon (ÎØºÏõê24) Login Module', true);
            updateEditor(codeStates.init);
            await new Promise(r => setTimeout(r, 500));
            await typeTerminalLine(`‚úî Init complete. Run: ${stepCommands[1].cmd}`, true);
            currentStep = 1;
            commandInput.disabled = false;
            commandInput.placeholder = "Press Tab for next command, then Enter";
            commandInput.focus();

        } else if (cmd.trim() === 'coocon-agent implement-hardcoded' && currentStep === 1) {
            await typeTerminalLine('‚ñ∫ Implementing hardcoded authentication flow...', true);
            updateEditor(codeStates.hardcoded);
            await new Promise(r => setTimeout(r, 500));
            await typeTerminalLine(`‚úî Hardcoded complete. Run: ${stepCommands[2].cmd}`, true);
            currentStep = 2;
            commandInput.disabled = false;
            commandInput.placeholder = "Press Tab for next command, then Enter";
            commandInput.focus();

        } else if (cmd.trim() === 'coocon-agent detect-dynamic-query' && currentStep === 2) {
            await typeTerminalLine('‚ñ∫ Detecting dynamic query parameters...', true);
            await typeTerminalLine('', true);
            await typeTerminalLine('‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ï¶‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ï¶‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó', true);
            await typeTerminalLine('‚ïë Parameter       ‚ïë Type    ‚ïë Description               ‚ïë', true);
            await typeTerminalLine('‚ï†‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ï¨‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ï¨‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ï£', true);
            await typeTerminalLine('‚ïë signedVals      ‚ïë DYNAMIC ‚ïë PKCS#7 signed cert data   ‚ïë', true);
            await typeTerminalLine('‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ï©‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ï©‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù', true);
            await typeTerminalLine('', true);
            updateEditor(codeStates.detectQuery);
            await new Promise(r => setTimeout(r, 500));
            await typeTerminalLine(`‚úî Detection complete. Run: ${stepCommands[3].cmd}`, true);
            currentStep = 3;
            commandInput.disabled = false;
            commandInput.placeholder = "Press Tab for next command, then Enter";
            commandInput.focus();

        } else if (cmd.trim() === 'coocon-agent implement-empty-function' && currentStep === 3) {
            await typeTerminalLine('‚ñ∫ Replacing hardcoded values with functions...', true);
            updateEditor(codeStates.emptyFunction);
            await new Promise(r => setTimeout(r, 500));
            await typeTerminalLine(`‚úî Replacement complete. Run: ${stepCommands[4].cmd}`, true);
            currentStep = 4;
            commandInput.disabled = false;
            commandInput.placeholder = "Press Tab for next command, then Enter";
            commandInput.focus();

        } else if (cmd.trim() === 'coocon-agent add-dynamic-function' && currentStep === 4) {
            await typeTerminalLine('‚ñ∫ Adding dynamicSignedVals function...', true);
            updateEditor(codeStates.addFunction);
            await new Promise(r => setTimeout(r, 500));
            await typeTerminalLine(`‚úî Function added. Run: ${stepCommands[5].cmd}`, true);
            currentStep = 5;
            commandInput.disabled = false;
            commandInput.placeholder = "Press Tab for next command, then Enter";
            commandInput.focus();

        } else if (cmd.trim() === 'coocon-agent add-function-details' && currentStep === 5) {
            await typeTerminalLine('‚ñ∫ Adding implementation comments...', true);
            updateEditor(codeStates.functionDetails);
            await new Promise(r => setTimeout(r, 500));
            await typeTerminalLine(`‚úî Details added. Run: ${stepCommands[6].cmd}`, true);
            currentStep = 6;
            commandInput.disabled = false;
            commandInput.placeholder = "Press Tab for next command, then Enter";
            commandInput.focus();

        } else if (cmd.trim() === 'coocon-agent show-isas-library' && currentStep === 6) {
            await typeTerminalLine('‚ñ∫ Loading top iSAS library functions...', true);
            await typeTerminalLine('Top 3 iSAS Library Functions:', true);
            await typeTerminalLine('1. certManager - Certificate management', true);
            await typeTerminalLine('2. httpRequest - HTTP communication', true);
            await typeTerminalLine('3. system - Utility functions', true);
            updateEditor(codeStates.isasLibrary);
            await new Promise(r => setTimeout(r, 600));
            await typeTerminalLine('‚ú® COMPLETE: MinWon login module fully generated!', true);
            currentStep = 7;
            commandInput.disabled = false;
            commandInput.placeholder = "Press Tab for 'help' command";
            commandInput.focus();

        } else if (cmd.trim() === 'help') {
            await typeTerminalLine('Available commands:', true);
            await typeTerminalLine('  clear - Clear terminal', true);
            commandInput.disabled = false;
            commandInput.focus();

        } else if (cmd.trim() === 'clear') {
            const lines = terminalOutput.querySelectorAll('.terminal-line');
            lines.forEach(line => line.remove());
            commandHistory = [];
            currentStep = 0;
            updateEditor(`<span class="hl-comment">// File is empty.</span>
<span class="hl-comment">// Use the terminal below to generate the Minwon login module.</span>
<span class="hl-comment">// Press Tab in terminal to autocomplete, then Enter to run</span>`);
            commandInput.disabled = false;
            commandInput.placeholder = "Press Tab to autocomplete command, then Enter to run";
            commandInput.focus();

        } else {
            if (currentStep === 0) {
                await typeTerminalLine(`Start with: coocon-agent init minwon_login`, true);
            } else if (currentStep < stepCommands.length) {
                await typeTerminalLine(`Next command: ${stepCommands[currentStep].cmd}`, true);
            } else {
                await typeTerminalLine(`Command not recognized. Type 'help' for available commands.`, true);
            }
            commandInput.disabled = false;
            commandInput.focus();
        }
    }

    // Event listeners - only allow Tab and Enter
    commandInput.addEventListener('keydown', (e) => {
        if (e.key === 'Tab') {
            e.preventDefault();
            if (currentStep < stepCommands.length) {
                const nextCmd = stepCommands[currentStep].cmd;
                commandInput.value = nextCmd;
            } else if (currentStep >= stepCommands.length) {
                if (commandInput.value === '' || commandInput.value === 'help') {
                    commandInput.value = 'clear';
                } else {
                    commandInput.value = 'help';
                }
            }
        } else if (e.key === 'Enter' && commandInput.value.trim() !== '') {
            handleCommand(commandInput.value);
        } else if (e.key !== 'Enter') {
            e.preventDefault();
            e.stopPropagation();
            return false;
        }
    });

    // Block other input events
    commandInput.addEventListener('keypress', (e) => {
        if (e.key !== 'Enter') {
            e.preventDefault();
            e.stopPropagation();
            return false;
        }
    });

    commandInput.addEventListener('input', (e) => {
        if (currentStep < stepCommands.length) {
            const expectedCmd = stepCommands[currentStep].cmd;
            if (commandInput.value !== expectedCmd && commandInput.value !== '') {
                commandInput.value = '';
            }
        } else if (commandInput.value !== 'help' && commandInput.value !== 'clear' && commandInput.value !== '') {
            commandInput.value = '';
        }
    });

    // Initialize
    setTimeout(() => {
        commandInput.placeholder = "Press Tab to autocomplete command, then Enter to run";
        commandInput.focus();
    }, 800);

</script>
</body>
</html>
